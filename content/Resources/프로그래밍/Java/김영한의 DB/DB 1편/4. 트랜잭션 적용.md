---
title: 
tags:
  - programming
  - sql
  - database
  - lock
  - transaction
  - java
  - spring
publish: true
date: 2024-12-12
---
## 트랜잭션 적용 1
실제 어플리케이션에서 DB 트랜잭션을 사용해서 계좌이체 같이 원자성이 중요한 비즈니스 로직을 어떻게 구현하는지 알아본다.

먼저 트랜잭션 없이 단순하게 계좌이체 비즈니스 로직만 구현해본다.

```java title="MemberServiceV1.java"
@RequiredArgsConstructor  
public class MemberServiceV1 {  
    private final MemberRepositoryV1 memberRepository;  
  
    public void transfer(String fromId, String toId, int money) throws SQLException {  
        Member fromMember = memberRepository.findById(fromId);  
        Member toMember = memberRepository.findById(toId);  
  
        memberRepository.update(fromId, fromMember.getMoney() - money);  
        validation(toMember);  
        memberRepository.update(toId, toMember.getMoney() + money);  
    }  
  
    private static void validation(Member toMember) {  
        if (toMember.getMemberId().equals("ex")) {  
            throw new IllegalStateException("이체 중 예외 발생");  
        }  
    }  
}
```

`transfer()`는 `fromId`의 회원을 조회해서 `toId`의 회원에게 `money`만큼의 돈을 이체하는 로직이다. 예외 상황을 테스트 해보기 위해 `toId`가 `ex`인 경우 예외를 발생 시킨다.

---
References: 김영한의 스프링 DB 1편

Links to this page: [[3. 트랜잭션 이해]]