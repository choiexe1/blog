---
title: 
tags:
  - java
  - programming
  - spring
  - transaction
  - propagation
publish: true
date: 2024-12-28
---
## 트랜잭션 전파 활용 1 - 예제 프로젝트
지금까지 학습한 트랜잭션 전파에 대한 내용을 실제 예제를 통해서 이해해본다.

**비즈니스 요구사항**
- 회원을 등록하고 조회한다.
- 회원에 대한 변경 이력을 추적할 수 있도록 회원 데이터가 변경될 때 변경 이력을 DB LOG 테이블에 남겨야 한다.
	- 예제를 단순화 하기 위해 회원 등록시에만 DB LOG 테이블에 남긴다.

```java
@Entity  
@Getter  
@Setter  
public class Member {  
    @Id  
    @GeneratedValue    private Long id;  
  
    private String username;  
  
    public Member() {  
    }  
  
    public Member(String username) {  
        this.username = username;  
    }  
}

@Entity  
@Getter  
@Setter  
public class Log {  
    @Id  
    @GeneratedValue    private Long id;  
    private String message;  
  
    public Log() {  
    }  
  
    public Log(String message) {  
        this.message = message;  
    }  
}

@Slf4j  
@Repository  
@RequiredArgsConstructor  
public class MemberRepository {  
    private final EntityManager em;  
  
    @Transactional  
    public void save(Member member) {  
        log.info("Member 저장");  
        em.persist(member);  
    }  
  
    public Optional<Member> findByUsername(String username) {  
        return em.createQuery("SELECT m FROM Member m WHERE m.username = :username", Member.class)  
                .setParameter("username", username)  
                .getResultList().stream().findFirst();  
    }  
}

@Slf4j  
@Repository  
@RequiredArgsConstructor  
public class LogRepository {  
    private final EntityManager em;  
  
    @Transactional  
    public void save(Log logMessage) {  
        log.info("Log 저장");  
        em.persist(logMessage);  
  
        if (logMessage.getMessage().equals("로그예외")) {  
            log.info("Log 저장 시 예외 발생");  
            throw new RuntimeException("예외 발생");  
        }  
    }  
}
```

다음은 `MemberService`를 구현해서 실험해보자.

```java
@Slf4j  
@Service  
@RequiredArgsConstructor  
public class MemberService {  
    private final MemberRepository memberRepository;  
    private final LogRepository logRepository;  
  
    public void joinV1(String username) {  
        Member member = new Member(username);  
        Log logMessage = new Log(username);  
  
        log.info("== memberRepository 호출 시작 ==");  
		memberRepository.save(member);  
		log.info("== memberRepository 호출 종료 =="); 
		 
		log.info("== logRepository 호출 시작 ==");  
		logRepository.save(logMessage);  
		log.info("== logRepository 호출 종료 ==");
    }  
}
```

---
References: 김영한의 스프링 DB

Links to this page: 