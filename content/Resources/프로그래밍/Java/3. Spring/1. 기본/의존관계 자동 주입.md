---
title: 
tags:
  - java
  - programming
  - spring
publish: true
date: 2024-11-18
---
## 다양한 의존관계 주입 방법
의존관계 주입은 다음과 같이 크게 4가지 방법이 있다.
- 생성자 주입
- 수정자 주입(setter 주입)
- 필드 주입
- 일반 메서드 주입

### 생성자 주입
지금까지 주로 사용했던 방법이다. 생성자를 통해서 의존 관계를 주입한다.

**특징**
- 생성자 호출 시점에 딱 1번만 호출되는 것이 보장된다.
- **불변**, **필수** 의존관계에 사용한다.

```java
@Component  
public class OrderServiceImpl implements OrderService {  
    private final MemberRepository memberRepository;  
    private final DiscountPolicy discountPolicy;
    
	@Autowired  
	public OrderServiceImpl(MemberRepository memberRepository, DiscountPolicy discountPolicy) {  
	    this.memberRepository = memberRepository;  
	    this.discountPolicy = discountPolicy; 
	}
}
```

> [!summary] @Autowired 생략
> 스프링 빈 컴포넌트에 생성자가 딱 1개만 존재하면, `@Autowired`를 생략해도 자동 주입 된다.
> 
> 이유는 생성자가 2개라면 스프링 컨테이너 입장에서, 어떤 생성자를 통해서 의존관계를 주입해야 할 지 모호성이 생기기 때문이다.

### 수정자 주입 (setter 주입)
필드 값을 변경하는 수정자 메서드인 세터를 통해서 의존관계를 주입하는 방법이다.

**특징**
- **선택**, **변경** 가능성이 있는 의존관계에 사용
- 자바 빈 프로퍼티 규약의 수정자 메서드 방식을 사용하는 방법이다.

```java
@Component  
public class OrderServiceImpl implements OrderService {  
    private MemberRepository memberRepository;  
    private DiscountPolicy discountPolicy;

	@Autowired
	public void setMemberRepository(MemberRepository memberRepository) {
		this.memberRepository = memberRepository;
	}
	
	@Autowired
	public void setDiscountPolicy(DiscountPolicy discountPolicy) {
		this.discountPolicy = discountPolicy;
	}
}
```

> [!summary] @Autowired의 기본 동작
> `@Autowired`의 기본 동작은 주입할 대상이 없으면 오류가 발생한다.
> 
> 예시로, 위 코드 예제에서 `MemberRepository`가 스프링 빈으로 등록되어 있지 않을 때는 스프링 컨테이너 내부에 주입할 대상이 없으므로 오류가 발생한다.
> 
> 주입할 대상이 없어도 동작하게 하려면 `@Autowired(required = false)`로 지정하면 된다.

### 필드 주입
이름 그대로 필드에 바로 주입하는 방법이다.

**특징**
- 외부에서 변경이 불가능하다. (테스트하기 힘들다는 치명적인 단점)
- DI 프레임워크가 없으면 주입이 불가능하기 때문에 아무것도 할 수 없다.
- 사용하지 말자.
	- 어플리케이션의 실제 코드와 관계 없는 테스트 코드
	- 스프링 설정을 목적으로 하는 `@Configuration`같은 곳에서만 특별한 용도로 사용

```java
@Component
public class OrderServiceImpl implements OrderService {
	@Autowired private MemberRepository memberRepository;
	@Autowired private DiscountPolicy discountPolicy;
}
```

> [!tip] 테스트 코드에 자동 주입 적용
> 테스트 코드에 `@Autowired`를 적용 시키기 위해서는 `@SpringBootTest` 어노테이션을 테스트 케이스 클래스에 적용 시켜서 스프링 컨테이너를 테스트에 통합한 경우에만 가능하다.

### 일반 메서드 주입
일반 메서드를 통해서 주입 받을 수 있다.

**특징**
- 한번에 여러 필드를 주입 받을 수 있다.
- 일반적으로 잘 사용하지 않는다.

```java
@Autowired  
public void init(MemberRepository memberRepository, DiscountPolicy discountPolicy) {  
    this.memberRepository = memberRepository;  
    this.discountPolicy = discountPolicy;  
}
```

## 옵션 처리
주입할 스프링 빈이 없어도 동작해야 할 때가 있다.

예를 들어 해당 클래스가 주입되지 않았으면 어떤 로직을 실행하지 않거나 하는 등의 조건에 필요하다.

그런데 `@Autowired`만 사용하면 `required` 옵션의 기본 값이 `true`로 되어 있어서, 자동 주입 대상이 없으면 오류가 발생한다.

자동 주입 대상을 옵션으로 처리하는 방법은 다음과 같다.
- `@Autowired(required=false)`: 자동 주입 할 대상이 없으면 수정자 메서드 자체가 호출이 안됨
- `org.springframework.lang.@Nullable`: 자동 주입할 대상이 없으면 null이 입력된다.
- `Optional<>`: 자동 주입할 대상이 없으면 Optional.empty가 입력된다.

```java
public class AutowiredTest {  
    @Test  
    void AutowiredOption() {  
        ApplicationContext ac = new AnnotationConfigApplicationContext(  
                TestBean.class);  
    }  
  
    static class TestBean {  
        @Autowired(required = false)  
        public void setNoBean1(Member noBean1) {  
            System.out.println("noBean1 = " + noBean1);  
        }  
  
        @Autowired  
        public void setNoBean2(@Nullable Member noBean2) {  
            System.out.println("noBean2 = " + noBean2);  
        }  
  
        @Autowired  
        public void setNoBean3(Optional<Member> noBean3) {  
            System.out.println("noBean3 = " + noBean3);  
        }  
    }  
}
```

- **setNoBean1(Member noBean1)**: `@Autowired(required=false)`로 설정되어 있어 메서드 자체를 호출 하지 않는다. 참고로 `Member`는 스프링 빈이 아니므로, `required` 옵션을 `true`로 설정 시 에러가 발생한다.
- **setNoBean(@Nullable Member noBean2)**: `@Nullable`은 `null`일 수도 있다는 어노테이션이다. 자바 8부터 지원한다. 메서드는 정상적으로 호출 되고, `null`이 출력된다.
- **setNoBean(Optional\<Member> noBean3)**: 마찬가지로 메서드는 호출되고, `noBean3` 파라미터의 값이 `Optinal.empty`로 입력된다.

## 생성자 주입을 선택하라
과거에는 수정자 주입과 필드 주입을 많이 사용했지만, 최근에는 스프링을 포함한 DI 프레임워크 대부분이 생성자 주입을 권장한다.

> `Nest.JS`도 제공자(Provider)로 DI 할 수 있지만, 보통은 생성자 주입을 사용했다.
> 



---
References: 김영한의 스프링 핵심 원리 - 기본편

Links to this page: 