---
title: 
tags:
  - java
  - programming
  - spring
  - servlet
  - mvc
publish: true
date: 2024-11-20
---
## 회원 관리 웹 어플리케이션
회원 관리 웹 어플리케이션을 만들어보면서 서블릿, JSP, MVC에 대해 학습한다.

```mermaid
classDiagram

class Member {
-Long id
-String username
-int age

+Member()
+Member(String username, int age)
}



```

**기능 요구사항**
- 회원 저장
- 회원 목록 조회

요구사항에 맞춰서 `MemberRepository`를 구현한다. 그리고 이 레포지토리는 싱글톤 패턴을 적용한다.

```java
public class MemberRepository {  
    private static Map<Long, Member> store = new HashMap<>();  
    private static Long sequence = 0L;  
  
    @Getter  
    private static final MemberRepository instance = new MemberRepository();  
  
    private MemberRepository() {}  
  
    public Member save(Member member) {  
        member.setId(++sequence);  
        store.put(member.getId(), member);  
  
        return member;  
    }  
  
    public Member findById(Long id) {  
        return store.get(id);  
    }  
  
    public List<Member> findAll() {  
        return new ArrayList<>(store.values());  
    }  
  
    public void clear() {  
        store.clear();  
    }  
}
```

테스트 코드도 간단히 작성한다.

```java
class MemberRepositoryTest {  
    MemberRepository memberRepository = MemberRepository.getInstance();  
  
    @AfterEach  
    void afterEach() {  
        memberRepository.clear();  
    }  
  
    @Test  
    void save() {  
        // given  
        Member member = new Member("hello", 20);  
  
        // when  
        Member savedMember = memberRepository.save(member);  
  
        // then  
        Member findMember = memberRepository.findById(savedMember.getId());  
        assertThat(savedMember).isSameAs(findMember);  
    }  
  
    @Test  
    void findAll() {  
        // given  
        Member member1 = new Member("member1", 20);  
        Member member2 = new Member("member2", 30);  
        memberRepository.save(member1);  
        memberRepository.save(member2);  
        // when  
        List<Member> all = memberRepository.findAll();  
  
        // then  
        assertThat(all.size()).isEqualTo(2);  
    }  
}
```


## 서블릿으로 회원 관리 웹 어플리케이션 개발
가장 먼저 서블릿을 활용해서 회원 관리 웹 어플리케이션을 개발해본다.

```java
@WebServlet(name = "memberFormServlet", urlPatterns = "/servlet/members/new-form")  
public class MemberFormServlet extends HttpServlet {  
    private MemberRepository memberRepository = MemberRepository.getInstance();  
  
    @Override  
    protected void service(HttpServletRequest req, HttpServletResponse res) throws ServletException, IOException {  
        res.setContentType("text/html");  
        res.setCharacterEncoding("utf-8");  
  
        PrintWriter w = res.getWriter();  
        w.write("<!DOCTYPE html>\n" +  
                "<html>\n" +  
                "<head>\n" +  
                " <meta charset=\"UTF-8\">\n" +  
                " <title>Title</title>\n" +  
                "</head>\n" +  
                "<body>\n" +  
                "<form action=\"/servlet/members/save\" method=\"post\">\n" +  
                " username: <input type=\"text\" name=\"username\" />\n" +  
                " age: <input type=\"text\" name=\"age\" />\n" +  
                " <button type=\"submit\">전송</button>\n" +  
                "</form>\n" +  
                "</body>\n" +  
                "</html>\n");  
    }  
}
```
폼 하나를 만들어서 전송하는데도 정말 힘들다. 

실제로 전 직장에서 이런 작업 비슷한걸 했었는데 정말 힘든 작업이다. 서버 사이드 렌더링이기 때문에 틀리면 재시작 해야 하는데 `"`를 잘못 작성한다던지, HTML 태그를 이상하게 작성했다던지.. 아무튼 귀찮고 짜증나는 작업이다.

또 하나의 작업이 더 있다. Form 요청을 받아서 실제로 저장이 이루어지는 페이지이다.


```java
@WebServlet(name = "memberSaveServlet", urlPatterns = "/servlet/members/save")  
public class MemberSaveServlet extends HttpServlet {  
    private MemberRepository memberRepository = MemberRepository.getInstance();  
  
    @Override  
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {  
        System.out.println("MemberSaveServlet.service");  
        String username = req.getParameter("username");  
        int age = Integer.parseInt(req.getParameter("age"));  
  
        Member member = new Member(username, age);  
        Member savedMember = memberRepository.save(member);  
  
        resp.setContentType("text/html");  
        resp.setCharacterEncoding("utf-8");  
        PrintWriter w = resp.getWriter();  
        w.write("<html>\n" +  
                "<head>\n" +  
                " <meta charset=\"UTF-8\">\n" +  
                "</head>\n" +  
                "<body>\n" +  
                "성공\n" +  
                "<ul>\n" +  
                " <li>id="+member.getId()+"</li>\n" +  
                " <li>username="+member.getUsername()+"</li>\n" +  
                " <li>age="+member.getAge()+"</li>\n" +  
                "</ul>\n" +  
                "<a href=\"/index.html\">메인</a>\n" +  
                "</body>\n" +  
                "</html>");  
    }  
}
```

마지막으로 조회 페이지도 만들어본다.

```java
@WebServlet(name = "memberListServlet", urlPatterns = "/servlet/members")  
public class MemberListServlet extends HttpServlet {  
    private MemberRepository memberRepository = MemberRepository.getInstance();  
  
    @Override  
    protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {  
        response.setContentType("text/html");  
        response.setCharacterEncoding("utf-8");  
        List<Member> members = memberRepository.findAll();  
        PrintWriter w = response.getWriter();  
        w.write("<html>");  
        w.write("<head>");  
        w.write(" <meta charset=\"UTF-8\">");  
        w.write(" <title>Title</title>");  
        w.write("</head>");  
        w.write("<body>");  
        w.write("<a href=\"/index.html\">메인</a>");  
        w.write("<table>");  
        w.write(" <thead>");  
        w.write(" <th>id</th>");  
        w.write(" <th>username</th>");  
        w.write(" <th>age</th>");  
        w.write(" </thead>");  
        w.write(" <tbody>");  
    }  
}
```

## 템플릿 엔진으로

지금까지 서블릿과 자바 코드만으로 HTML을 만들어보았다. 서블릿 덕분에 동적으로 원하는 HTML을 마음껏 만들 수 있다. 정적인 HTML 문서라면 화면이 계속 변화해야하는 회원의 저장 결과라던가 회원 목록을 보여주는 페이지를 만드는 것은 불가능 하다.

그런데 코드에서 보듯이 이것은 매우 복잡하고 비효율적이다. 자바 코드로 HTML을 만들어 내는 것 보다 차라리 HTML 문서에 동적으로 변경해야 하는 부분만 자바 코드를 넣을 수 있다면 편리할 것이다.

이것이 바로 템플릿 엔진이 나온 이유이다. 템플릿 엔진을 이용하면 HTML 문서에서 필요한 곳만 코드를 적용해서 동적으로 변경할 수 있다.

다음 시간에는 `JSP`로 동일한 작업을 진행해본다.

> [!tip]
> JSP는 성능과 기능면에서 다른 템플릿 엔진과의 경쟁에서 밀리면서, 점점 사장되어 가는 추세이다. 템플릿 엔진들은 각각 장단


---
References: 김영한의 스프링 MVC 1편

Links to this page: 