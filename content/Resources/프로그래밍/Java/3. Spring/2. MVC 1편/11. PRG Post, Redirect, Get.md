---
title: 
tags:
  - java
  - programming
  - spring
  - mvc
publish: true
date: 2024-11-24
---
## PRG Post, Redirect, Get
다음의 상품 등록 처리 컨트롤러는 심각한 문제가 있다. 상품 등록을 완료하고 웹 브라우저의 새로고침 버튼을 클릭해보면 상품이 계속해서 중복 등록 되는 것을 알 수 있다.

```java
@Controller  
@RequestMapping("/basic/items")  
@RequiredArgsConstructor  
public class BasicItemController {  
    private final ItemRepository itemRepository;  
  
    @GetMapping  
    public String items(Model model) {  
        List<Item> items = itemRepository.findAll();  
        model.addAttribute("items", items);  
        return "basic/items";  
    }  
  
    @GetMapping("/{itemId}")  
    public String item(@PathVariable long itemId, Model model) {  
        Item item = itemRepository.findById(itemId);  
        model.addAttribute("item", item);  
        return "basic/item";  
    }  
  
    @GetMapping("/add")  
    public String addForm() {  
        return "basic/addForm";  
    }  
  
    @PostMapping("/add")  
    public String save(Item item) {  
        itemRepository.save(item);  
        return "basic/item";  
    }  
  
    @GetMapping("/{itemId}/edit")  
    public String editForm(@PathVariable long itemId, Model model) {  
        Item item = itemRepository.findById(itemId);  
  
        model.addAttribute("item", item);  
        return "basic/editForm";  
    }  
  
    @PostMapping("/{itemId}/edit")  
    public String edit(@PathVariable long itemId, Item item) {  
        itemRepository.update(itemId, item);  
        return "redirect:/basic/items/{itemId}";  
    }  
  
    @PostConstruct  
    public void init() {  
        itemRepository.save(new Item("itemA", 10000, 10));  
        itemRepository.save(new Item("itemB", 20000, 20));  
    }  
}
```

### 새로 고침 중복 등록 문제

![[prg-1.png]]

웹 브라우저의 새로고침은 마지막에 서버에 전송한 데이터를 다시 전송한다.

 상품 등록 폼에서 데이터를 입력하고 저장을 선택하면 `POST /add`로 상품 데이터를 서버로 전송한다.
 이 상태에서 새로고침을 또 선택하면 마지막에 전송한 `POST /add`로 다시 데이터를 전송한다. 그래서 내용은 같고 ID만 다른 상품 데이터가 계속 쌓이게 된다.

이 문제를 어떻게 해결할 수 있을까?

![[prg-2.png]]

새로 고침 문제를 해결하려면 상품 저장 후에 뷰 템플릿으로 이동하는게 아니라, 상품 상세 화면으로 리다이렉트를 호출해주면 된다.

웹 브라우저는 리다이렉트의 영향으로 상품 저장 후에 실제 상품 상세 화면으로 다시 이동한다. 따라서 마지막에 호출한 내용이 상품 상세 화면인 `GET /items/{id}`가 되는 것이다. 이후엔 새로고침을 해도 상품 상세 화면으로 이동하게 되므로 새로 고침 중복 등록 문제를 해결할 수 있다.

상품 등록 처리 이후에 뷰 템플릿이 아니라 상품 상세화면으로 리다이렉트 하도록 코드를 수정한다. 이런 문제 해결 방식을 PRG Post, Redirect, Get이라 한다.

- POST 요청을 리다이렉트해서, GET 요청으로 보낸다.


---
References: 김영한의 스프링 MVC 1편

Links to this page: 