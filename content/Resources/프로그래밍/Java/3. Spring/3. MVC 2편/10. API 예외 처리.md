---
title: 
tags:
  - java
  - programming
  - api
  - exception
  - spring
  - mvc
publish: true
date: 2024-12-03
---
## API 예외 처리
HTML 페이지를 직접 렌더링 하는 MVC 구조의 웹 어플리케이션의 경우 `4xx`, `5xx`와 같은 오류 페이지만 존재하면 대부분의 문제를 해결할 수 있다.

그런데 API의 경우에는 생각할 내용이 더 많다. 오류 페이지는 단순히 고객에게 오류 화면을 보여주고 끝이지만 API는 각 오류 상황에 맞는 오류 응답 스펙을 정하고, JSON으로 데이터를 내려주어야 한다.

먼저 다음과 같은 간단한 Restful API 컨트롤러를 구현한다.

```java
@RestController  
@RequestMapping("/api")  
public class ApiExceptionController {  
    @GetMapping("/members/{id}")  
    public MemberDto getMember(@PathVariable("id") String id) {  
        if (id.equals("ex")) {  
            throw new RuntimeException("잘못된 사용자");  
        }  
  
        return new MemberDto(id, "hello" + id);  
    }  
  
    @Data  
    @AllArgsConstructor    static class MemberDto {  
        private String memberId;  
        private String name;  
    }  
}
```

그리고 앞서 만들었던 서블릿의 `WebServerCustomizer` 구현체를 이용해본다.

```java
@Component  
public class WebServerCustomizer implements WebServerFactoryCustomizer<ConfigurableWebServerFactory> {  
    @Override  
    public void customize(ConfigurableWebServerFactory factory) {  
        ErrorPage errorPage404 = new ErrorPage(HttpStatus.NOT_FOUND, "/error-page/404");  
        ErrorPage errorPage500 = new ErrorPage(HttpStatus.INTERNAL_SERVER_ERROR, "/error-page/500");  
        ErrorPage errorPageEx = new ErrorPage(RuntimeException.class, "/error-page/500");  
  
        factory.addErrorPages(errorPage404, errorPage500, errorPageEx);  
    }  
}
```

이제 `ApiExceptionController`의 `getMember`에서 오류가 발생하면 런타임 예외가 발생하고, 이 예외는 여러 단계를 거쳐 서블릿에 전달된다.

앞서 학습한 대로 서블릿에 예외가 전달되면, 각 예외에 따라 지정된 경로의 컨트롤러를 다시 호출한다. 그리고



---
References: 김영한의 스프링 MVC 2편

Links to this page: 