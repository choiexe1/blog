---
title: 
tags:
  - java
  - programming
  - spring
  - mvc
  - http
publish: true
date: 2024-12-07
---
## 파일 업로드 소개
일반적으로 사용하는 HTML Form을 통한 파일 업로드를 이해하려면 먼저 폼을 전송하는 다음 두 가지 방식의 차이를 이해해야 한다.

- `applicaion/x-www-form-urlencoded`
- `multipart/form-data`


### application/x-www-form-urlencoded 방식

다음의 그림과 같이, 폼을 전송하면 웹 브라우저가 우측의 HTTP 메시지를 생성하고 서버에 전달한다.

![[form-file-upload-1.png]]

`applicaion/x-www-form-urlencoded` 방식은 HTML 폼 데이터를 서버로 전송하는 가장 기본적인 방법이다. Form 태그에 별도의 `enctype` 옵션이 없으면 웹 브라우저는 요청 HTTP 메시지 헤더에 다음 내용을 추가한다.

`Content-Type: application/x-www-form-urlencoded`

그리고 폼에 입력한 전송할 항목을 HTTP Body에 마치 쿼리 파라미터 전송 형식과 동일한 형식으로 전송한다.

`username=kim&age=20`

파일을 업로드 하려면 파일은 문자가 아니라 바이너리 데이터를 전송해야 한다. 문자를 전송하는 이 방식으로 파일을 전송하기는 어렵다. 그리고 또 한가지 문제가 더 있는데 보통 폼을 전송할 때 파일만 전송하는 것이 아니라는 점이다.

보통 다음과 같은 폼이 구성된다.

- 이름
- 나이
- 첨부파일

여기선 이름과 나이도 전송해야 하고, 첨부파일도 함께 전송해야 한다. 문제는 이름과 나이는 문자로 전송하고, 첨부파일은 바이너리로 전송해야 한다는 점이다. **문자와 바이너리**를 동시에 전송 해야 하는 상황인 것이다.

이 문제를 해결하기 위해 HTTP는 `multipart/form-data`라는 전송 방식을 제공한다.

### multipiart/form-data 방식

![[form-file-upload-2.png]]

위 그림과 같이, 이 방식을 사용하려면 Form 태그에 별도의 `enctype="multipart/form-data"`를 지정해야 한다.

웹 브라우저가 생성한 HTTP 메시지를 살펴보면 여러 개의 다른 형식의 데이터를 한번에 보낼 수 있게 되어 있다. 그래서 이름이 멀티파트인 것이다.

```
Content-Disposition: form-data; name="file1"; filename="intro.png" Content-Type: image/png

109238a...
------XXX--
```

예제에서는 `username`, `age`, `file1`이 각각 분리되어 있고, 폼의 일반 데이터는 각 항목별로 문자가 전송되고 첨부 파일의 경우 파일에 대한 메타데이터인 파일 이름과 `Content-Type`이 추가되고 바이너리 데이터가 전송된다.

이렇듯 `multipart/form-data` 방식은 각각의 항목을 구분해서 다른 종류의 여러 데이터를 함께 전송할 수 있다.

살펴본 대로 `multipart/form-data`는 일반적인 폼 전송 방식인 `application/x-www-form-urlencoded`와 다른 형식으로 서버에 전송된다.

따라서 서버에서 전달받는 HTTP 메시지 형식도 다르다. 일반적인 HTTP 메시지를 전달 받아 사용하기엔 무리가 있다.

이런 형식의 HTTP 메시지는 서버에서 어떻게 전달 받아 사용할 수 있을까?

## 서블릿과 파일 업로드 1
HTTP Form을 통한 파일 업로드는 `multipart/form-data`를 사용한다. 이 방식으로 생성되는 HTTP 메시지 형식이 다르고, 따라서 서버에서 해당 형식을 파싱해야 한다는 점을 앞서 학습했다.

먼저 다음의 의존성을 가지는 스프링 부트 프로젝트를 생성한다.

- Lombok
- Spring Web
- Thymeleaf
- Spring Boot Devtools (편의 상 추가)

그리고 다음의 예제 컨트롤러를 정의한다.

```java
@Slf4j  
@Controller  
@RequestMapping("/servlet/v1")  
public class ServletUploadControllerV1 {  
    @GetMapping("/upload")  
    public String newFile() {  
        return "upload-form";  
    }  
  
    @PostMapping("/upload")  
    public String saveFileV1(HttpServletRequest request) throws ServletException, IOException {  
        log.info("request = {}", request);  
  
        String itemName = request.getParameter("itemName");  
        log.info("itemName = {}", itemName);  
  
        Collection<Part> parts = request.getParts();  
        log.info("parts = {}", parts);  
  
        return "upload-form";  
    }  
}
```

서블릿이 지원하는 `HttpSevletRequest`를 사용하면 `getParts()` 메서드를 통해 `multipart/form-data` 형식의 HTTP 메시지 각 항목을 획득할 수 있다.

업로드를 담당하는 뷰 템플릿으



---
References: 김영한의 스프링 MVC

Links to this page: 