---
title: 
tags:
  - java
  - programming
  - spring
  - file
  - upload
  - download
  - mvc
publish: true
date: 2024-12-07
---
## 예제로 구현하는 파일 업로드, 다운로드

[[12. 파일 업로드]]에서 `multipart/form-data`가 어떤 형식으로 서버에 전송되고 서블릿과 스프링은 해당 형식의 HTTP 메시지를 어떻게 다루는지 에서 학습했다.

이번에는 실제 파일이나 이미지를 업로드, 다운로드 할 때 몇가지 고려할 점들을 구체적으로 예제를 구현해보며 알아본다.

**서비스 요구사항**

- 상품 관리 기능
	- 상품 이름
	- 첨부파일 하나
	- 이미지 파일 여러개
- 첨부 파일을 업로드, 다운로드 할 수 있다.
- 업로드한 이미지를 웹 브라우저에서 확인할 수 있다.

먼저 다음과 같이 도메인을 정의한다.

```java title="UploadFile.java"
@Data  
public class UploadFile {  
    private String uploadFileName;  
    private String storeFileName;

	public UploadFile(String uploadFileName, String storeFileName) {  
	    this.uploadFileName = uploadFileName;  
	    this.storeFileName = storeFileName;  
	}
}
```

`UploadFile` 클래스는 업로드 된 파일 명과, 저장된 실제 파일 명을 문자열로 가진다.

> [!warning]
> 파일 명 필드가 두개인 것은 고객이 업로드 한 파일명으로 서버 내부에 파일을 저장하면 안되기 때문이다.
> 
> 왜냐하면 서로 다른 두 고객이 같은 파일 이름을 업로드 하는 경우 기존 파일 이름과 충돌이 일어나 기존 파일에 바이너리가 덮어씌워 지거나 해서 사라질 수 있다.
> 
> 서버에서는 저장할 파일명이 겹치지 않도록 내부에서 관리하는 별도의 고유한 파일명이 필요하다.


```java title="Item.java"
@Data  
public class Item {  
    private Long id;  
    private String itemName;  
    private UploadFile attachFile;  
    private List<UploadFile> imageFiles;  
}
```

`Item` 클래스는 고유한 `id`와, `itemName` 그리고 앞서 정의했던 `UploadFile`을 값으로 가지고 `UploadFile`을 `List` 형태로 `imageFiles`를 가진다.

```java title="ItemRepository.java"
@Repository  
public class ItemRepository {  
    private final Map<Long, Item> store = new HashMap<>();  
    private long sequence = 0L;  
  
    public Item save(Item item) {  
        item.setId(++sequence);  
        store.put(item.getId(), item);  
        return item;  
    }  
  
    public Item findById(Long id) {  
        return store.get(id);  
    }  
}
```

`Item`을 저장하고, 찾을 수 있도록 간단한 저장소를 구현했다.

이제 다음과 같이 파일을 직접 관리하는 책임을 가지는 `FileStore`를 구현한다.

```java title="FileStore.java"

```




---
References: 김영한의 스프링 MVC 2편

Links to this page: [[12. 파일 업로드]]