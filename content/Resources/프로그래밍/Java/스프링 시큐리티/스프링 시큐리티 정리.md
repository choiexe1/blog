---
title: 
tags: 
publish: true
date: 2024-12-25
---
최근엔 여태 학습한 내용을 토대로 프로젝트를 만들어보고 있는데, 로그인 처리나 인가 처리가 여간 귀찮은게 아니다.

물론 필터나 인터셉터를 통해서 직접 구현해도 되지만, 그 구현하는 과정까지가 귀찮고 혹여 직접 인증과 인가 로직을 개발한 사람이 아니라면 코드를 유지보수 하기도 조금 힘들 것 같다는 생각이 들었다. 따라서 스프링 시큐리티를 좀 더 학습하고, 그 뒤에 프로젝트에 다시 적용해보려고 한다.

## DelegatingFilterProxy
`DelegatingFilterProxy`는 스프링 시큐리티가 제공하는 서블릿 필터이다. 실제로 서블릿에 필터로 등록되고 `FilterChainProxy`에게 중간에서 보안 처리를 위임한다. 

그럼 `DelegatingFilterProxy`가 왜 필요한걸까? 이를 이해하기 위해서는 다음의 두 가지 사실을 알아두어야 한다.

- 서블릿 필터는 서블릿 컨테이너에서 관리한다.
- 스프링 빈은 스프링 컨테이너에서 관리한다.

이 `DelegatingFilterProxy`는 서블릿 컨테이너와 스프링 컨테이너를 연결하기 위해 필요한 것이다.

**사용자 요청 흐름**

1. 사용자의 요청이 서블릿 컨테이너에 도착
2. 서블릿 필터인 `DelegatingFilterProxy`가 호출됨
3. `DelegatingFilterProxy`는 `FilterChainProxy`에게 보안 작업 위임(쉽게 말해, HttpServletRequest등 보안 처리에 필요한 컨텍스트 전달)
4. `SecurityFilterChain`이 보안 필터를 순차적으로 실행
5. 인증/인가 결과에 따라 결과 반환


이로 인해 얻는 장점은 필터를 스프링 컨테이너에서 관리하므로 설정을 변경하거나, 테스트하기 쉬워진다는 장점이 있다.

> [!summary] DelegatingFilterProxy (서블릿 필터)
> `DelegatingFilterProxy`는 서블릿 필터 시스템과 스프링 빈 시스템을 연결하는 **중개자(Delegate)** 역할을 한다.

## FilterChainProxy
보안 작업을 위임 받은 `FilterChainProxy`는 필터 체인 관리 역할을 하는 클래스이다. 

무슨 이야기냐면, 여러 보안 필터들을 이 곳에서 관리하고 필터 체인 목록 중 해당 요청과 매핑되는 필터 체인을 선택한다.

**사용자 요청 흐름**

1. `/admin`으로 요청
2. `DelegatingFilterProxy`가 `FilterChainProxy`에게 보안 작업 위임
3. `FilterChainProxy`는 해당 요청과 매핑되는 필터 체인을 찾고, 필터들을 순차적으로 실행



**FilterChainProxy 내부 구조**

`FilterChainProxy`는 다음과 같이 수 많은 필터를 효율적으로 관리하고, 요청 URL에 따라 필터 체인을 동적으로 선택한다.

```
FilterChainProxy
    ├── FilterChain 1: URL 패턴 /admin
    │      ├── SecurityContextPersistenceFilter
    │      ├── UsernamePasswordAuthenticationFilter
    │      ├── FilterSecurityInterceptor
    │
    ├── FilterChain 2: URL 패턴 /user
    │      ├── SecurityContextPersistenceFilter
    │      ├── BasicAuthenticationFilter
    │      ├── FilterSecurityInterceptor
    │
    ├── FilterChain 3: 기본 체인
           ├── SecurityContextPersistenceFilter
           ├── AnonymousAuthenticationFilter
           ├── ExceptionTranslationFilter
```



## SecurityFilterChain
스프링 시큐리티의 `SecurityFilterChain`은 사용자의 요청이 서버에 도달하기 전에 보안 검사를 수행하는 일련의 필터(Filter)로 구성되어있다. 

---
References: 

Links to this page: 